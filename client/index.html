<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Examination Management System</title>
  <meta name="description" content="Free Bootstrap Theme by BootstrapMade.com">
  <meta name="keywords" content="free website templates, free bootstrap themes, free template, free bootstrap, free website template">

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans|Candal|Alegreya+Sans">
  <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/imagehover.min.css">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <script src="js/vue.js"></script>
  <!-- =======================================================
    Theme Name: Mentor
    Theme URL: https://bootstrapmade.com/mentor-free-education-bootstrap-theme/
    Author: BootstrapMade.com
    Author URL: https://bootstrapmade.com
  ======================================================= -->
</head>

<body>
  <!--Navigation bar-->
  <div id="app">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">UENR EXAM<span> MANAGER </span></a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav navbar-right">
            <li class="btn-trial"><a href="#" id="lp_view_timetable" data-toggle="modal" data-target="#exampleModal">View Time-Table</a></li>
            <li class="btn-trial"><a href="#" data-target="#stafflogin" data-toggle="modal">Staff Sign in</a></li>
            <li class="btn-trial"><a href="#" data-target="#adminlogin" data-toggle="modal">Admin Sign in</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <!--/ Navigation bar-->
    <!--Modal box-->
    <div class="modal fade" id="stafflogin" role="dialog">
      <div class="modal-dialog modal-sm">

        <!-- Modal content no 1-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title text-center form-title">Staff Login</h4>
          </div>
          <div class="modal-body padtrbl">

            <div class="login-box-body">
              <p class="login-box-msg">Sign in to start your session</p>
              <div class="form-group">
                <form name="" id="loginForm">
                  <div class="form-group has-feedback">
                    <!----- username -------------->
                    <input class="form-control" placeholder="Username" id="loginid" type="text" autocomplete="off" v-model="staff_username" />
                    <span style="display:none;font-weight:bold; position:absolute;color: red;position: absolute;padding:4px;font-size: 11px;background-color:rgba(128, 128, 128, 0.26);z-index: 17;  right: 27px; top: 5px;" id="span_loginid"></span>
                    <span style="color: red;">{{error1_msg}}</span>
                    <!---Alredy exists  ! -->
                    <span class="glyphicon glyphicon-user form-control-feedback"></span>
                  </div>
                  <div class="form-group has-feedback">
                    <!----- password -------------->
                    <input class="form-control" placeholder="Password" id="loginpsw" type="password" autocomplete="off"  v-model="staff_password"/>
                    <span style="display:none;font-weight:bold; position:absolute;color: grey;position: absolute;padding:4px;font-size: 11px;background-color:rgba(128, 128, 128, 0.26);z-index: 17;  right: 27px; top: 5px;" id="span_loginpsw"></span>
                    <span style="color: red">{{error2_msg}}</span>
                    <!---Alredy exists  ! -->
                    <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                  </div>
                  <div class="row">
                    <div class="col-xs-12">
                      <div class="checkbox icheck">
                        <label>
                                  <input type="checkbox" id="loginrem"> Remember Me
                                </label>
                      </div>
                    </div>
                    <div class="col-xs-12">
                      <button type="button" class="btn btn-green btn-block btn-flat" @click.prevent="stafflogin()">Sign In</button>
                      <div style="text-align: center">
                        <br>
                        <span style="color: red">{{staff_signin_message}}</span>
                        <div class="fa-spin text-success"  role="status" v-show="show_staff">
                          <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
                          <span class="sr-only">Loading...</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="modal fade" id="adminlogin" role="dialog">
      <div class="modal-dialog modal-sm">

        <!-- Modal content no 1-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title text-center form-title">Admin Login</h4>
          </div>
          <div class="modal-body padtrbl">

            <div class="login-box-body">
              <p class="login-box-msg">Sign in to start your session</p>
              <div class="form-group">
                <form name="" id="loginForm">
                  <div class="form-group has-feedback">
                    <!----- username -------------->
                    <input class="form-control" placeholder="Username" id="loginid" type="text" autocomplete="off" v-model="admin_username"/>
                    <span style="display:none;font-weight:bold; position:absolute;color: red;position: absolute;padding:4px;font-size: 11px;background-color:rgba(128, 128, 128, 0.26);z-index: 17;  right: 27px; top: 5px;" id="span_loginid"></span>
                    <span style="color: red;">{{error3_msg}}</span>
                    <!---Alredy exists  ! -->
                    <span class="glyphicon glyphicon-user form-control-feedback"></span>
                  </div>
                  <div class="form-group has-feedback">
                    <!----- password -------------->
                    <input class="form-control" placeholder="Password" id="loginpsw" type="password" autocomplete="off" v-model="admin_password"/>
                    <span style="display:none;font-weight:bold; position:absolute;color: grey;position: absolute;padding:4px;font-size: 11px;background-color:rgba(128, 128, 128, 0.26);z-index: 17;  right: 27px; top: 5px;" id="span_loginpsw"></span>
                    <span style="color: red;">{{error4_msg}}</span>
                    <!---Alredy exists  ! -->
                    <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                  </div>
                  <div class="row">
                    <div class="col-xs-12">
                      <div class="checkbox icheck">
                        <label>
                                  <input type="checkbox" id="loginrem" > Remember Me
                                </label>
                      </div>
                    </div>
                    <div class="col-xs-12">
                      <button type="button" class="btn btn-green btn-block btn-flat" @click="adminlogin()">Sign In</button>
                      <div style="text-align: center">
                        <br>
                        <span style="color: red">{{admin_signin_message}}</span>
                        <div class="fa-spin text-success"  role="status" v-show="show_admin">
                          <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
                          <span class="sr-only">Loading...</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    <!--/ Modal box-->

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-6 form-group">
                  <select class="form-control" v-model="selected_level">
                    <option value="" selected disabled>select level</option>
                    <option>100</option>
                    <option>200</option>
                    <option>300</option>
                    <option>400</option>
                  </select>
                  <span class="text-danger">{{level_error}}</span>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-6 form-group">
                  <select class="form-control" v-model="selected_program">
                    <option value="" selected disabled>select program</option>
                    <option v-for="(program,key) of all_programs" :key="key">{{program.program_name}}</option>
                  </select>
                  <span class="text-danger">{{program_error}}</span>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <a href="#" class="btn btn-success" @click.prevent="view_time_table_as_pdf">View Timetable</a><!-- redirects to pdf timetable -->
          </div>
        </div>
      </div>
    </div>
    <!-- end view timetable modal -->
    <!--Banner-->
    <div class="banner">
      <div class="bg-color">
        <div class="container">
          <div class="row">
            <div class="banner-text text-center">
              <div class="text-border">
                <h2 class="text-dec">Non-Clashing</h2>
              </div>
              <div class="intro-para text-center quote">
                <p class="big-text">Examination Scheduling And Attendance Based System</p>
                <p class="small-text"></p>
                <a href="viewtimetable.html" class="btn get-quote">VIEW TIME-TABLE BY PROGRAM</a>
              </div>
              <a href="#" class="mouse-hover">
                <div class="mouse"></div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Table for displaying timetable -->
    <div class="center" hidden="true" id="element-to-print">
        <div class="table-responsive">
          <!-- Table  -->
          <table class="table table-hover table-responsive table-sm w-100 m-0">
            <!-- Table head -->
            <thead class="thead-dark">
              <tr>
                <th>Exam Date</th>
                <th>Exam Time</th>
                <th>Programme</th>
                <th>Course Code</th>
                <th>Level</th>
                <th>Lecture Halls</th>
                <th>Examiner</th>
                <th>Number of Students</th>
                <th>Course code</th>
              </tr>
            </thead>
            <!-- Table head -->

            <!-- Table body -->
            <tbody>
              <tr v-for="(table,key) of all_fetched_time_table" :key="key">
                <td>
                  {{table.exam_date}}
                </td>
                <td>
                  {{table.exam_time}}
                </td>
                <td>
                  {{table.program_name}}
                </td>
                <td>
                  {{table.course_name}}
                </td>
                <td>
                 {{table.level}}
                </td>
                <td>
                  <span v-for="(hall,key) of table.lecture_halls" :key="key">{{hall}},</span>
                 </td>
                <td>
                  {{table.examiner}}
                </td>
                
                <td>
                  {{table.number_of_students}}
                </td>
                  
                <td>
                  {{table.course_code}}
                </td>
              </tr>
            </tbody>
            <!-- Table body -->
          </table>
          <!-- Table  -->
        </div>
    </div>
    <!-- end table -->

    <!--Footer-->
    <footer id="footer" class="footer">
      <div class="container text-center">
        Â©2020 EXAM MANAGER. All rights reserved
    </footer>
  </div>
  <!--/ Footer-->
  <script src="js/vue.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.easing.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <scrip src="js/custom.js"></script>
  <script src="contactform/contactform.js"></script>

  <script>
    function demoFromHTML() {
    var pdf = new jsPDF('p', 'pt', 'letter');
    // source can be HTML-formatted string, or a reference
    // to an actual DOM element from which the text will be scraped.
    source = $('#element-to-print')[0];

    // we support special element handlers. Register them with jQuery-style 
    // ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
    // There is no support for any other type of selectors 
    // (class, of compound) at this time.
    specialElementHandlers = {
        // element with id of "bypass" - jQuery style selector
        '#bypassme': function (element, renderer) {
            // true = "handled elsewhere, bypass text extraction"
            return true
        }
    };
    margins = {
        top: 80,
        bottom: 60,
        left: 40,
        width: 522
    };
    // all coords and widths are in jsPDF instance's declared units
    // 'inches' in this case
    pdf.fromHTML(
    source, // HTML string or DOM elem ref.
    margins.left, // x coord
    margins.top, { // y coord
        'width': margins.width, // max width of content on PDF
        'elementHandlers': specialElementHandlers
    },

    function (dispose) {
        // dispose: object with X, Y of the last line add to the PDF 
        //          this allow the insertion of new lines after html
        pdf.save('time_table.pdf');
    }, margins);
}
   let app = new Vue({
      el: "#app",
      data: {
        staff_username: "",
        staff_password: "",
        admin_password: "",
        admin_username: "",
        username_error: "Username required",
        pass_error: "Password required",
        error1_msg: "",
        error2_msg: "",
        error3_msg: "",
        error4_msg: "",
        admin_signin_message: "",
        staff_signin_message: "",
        show_admin: false,
        show_staff: false,
        selected_program: null,
        all_programs: null,
        selected_level: "",
        level_error: "",
        program_error: "",
        all_fetched_time_table: null
      },
      methods: {
        stafflogin () {
          app.staff_signin_message = "";
          if(!(this.staff_username)) this.error1_msg = this.username_error;
          else this.error1_msg = "";
          if(!(this.staff_password)) this.error2_msg = this.pass_error;
          else this.error2_msg = "";

          if(this.staff_username.length !==0  && this.staff_password.length !==0){
            this.show_staff= true
            setTimeout(function(){
              app.ajax_staff_signin()
            }, 3000)
          }
        },
        async ajax_staff_signin(){
          try {
              let staff_login = await $.ajax({
                url: "http://localhost:3000/staff/signin",
                method: "post",
                data: {email: this.staff_username, password: this.staff_password},
                dataType: "json"
              })

              if(staff_login.res === "failed"){this.show_staff= false; this.staff_signin_message = staff_login.message}
              else{
                this.show_staff = false
                this.staff_signin_message = staff_login.message
                window.location = "invigilator/index.html"
              };
            } catch (error) {
              console.log(error)
            }
        },
        adminlogin (){
          app.admin_signin_message = ""
          if(!(this.admin_username)) this.error3_msg = this.username_error;
          else this.error3_msg = "";
          if(!(this.admin_password)) this.error4_msg = this.pass_error;
          else this.error4_msg = ""

          if(this.admin_username.length !==0  && this.admin_password.length !==0){
              this.show_admin = true
              setTimeout(function(){
                app.ajax_admin_sigin()
              },3000)
          }
        },
        async view_time_table_as_pdf(){
          if(!vm.selected_level) vm.level_error = "Please select level"
          else vm.level_error = ""
          if(!vm.selected_program) vm.program_error = "please select a program"
          else vm.program_error = ""

          if(vm.selected_level.length !== 0 && vm.selected_program.length !== 0){
            try {
              let fetched_programs = await $.ajax({
                url: "/student/student_time_table",
                method: "POST",
                dataType: "JSON",
                data: {
                  level: vm.selected_level,
                  program_name: vm.selected_program
                }
              })

              let { res,data } = fetched_programs

              if(res === "found"){
                vm.all_fetched_time_table = data

                demoFromHTML()
              }
            } catch (e) {
              console.log(e)
            }
          }
        },
        async ajax_admin_sigin(){
          try {
                let admin_signin = await $.ajax({
                    method: "post",
                    url: "http://localhost:3000/admin/signin",
                    data: {email: this.admin_username, password: this.admin_password}
                })

                if(admin_signin.res === "failed") {this.show_admin = false; this.admin_signin_message = admin_signin.message;}
                else {
                  this.show_admin = false
                  window.location = "admin/index.html"
                  this.admin_signin_message = admin_signin.message;
                }
              } catch (error) {
                console.log(error)
              }
        }
      },
      computed: {

      },
     async created(){
        try {
          let all_student_programs = await $.ajax({
            url: "/program/all_programs",
            method: "GET",
            dataType: "JSON"
          })

          let {data,res} = all_student_programs

          if(res === "found") vm.all_programs = data
        } catch (e) {
          console.log(e)
        }
      }
    }).$mount("#app")
  </script>

</body>

</html>
